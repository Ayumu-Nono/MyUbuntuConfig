# 外部からsshできるようにする

参考->[【sshサーバー】ubuntu sshサーバー構築〜LAN内外からのssh接続まで](https://qiita.com/s-inoue-git/items/fdd7aac2996297424a1f#5-lan%E5%A4%96%E3%81%8B%E3%82%89%E3%81%AEssh%E6%8E%A5%E7%B6%9A)

## (0) プラン変更

契約中の「v6プラン」はポート開放ができないため、プロバイダに連絡し、「v4プラン」に変更。
混雑時にやや速度が落ちるらしいがまあいいでしょう。

## (1) port開放

[https://192.168.0.1](https://192.168.0.1)からルータ設定にログイン。IODATAルータの場合、詳細設定>ポートの開放を選択。
各項目に値を設定。


## (2) ドメインの取得

(結局これ使わずにグローバルIPでやる)

MyDNSというサイトでドメインを取得。

## (3) グローバルIPの自動更新

グローバルIPは固定IPでないと自動更新されてしまうのでDDNSで取得したドメインとの紐付けを再度行う必要がある

それを今回はcronで自動的に実行する

```
$ crontab -e
```

```
#以下の１行を追加して保存
#これで10分おきにMyDNSに対してHTTPリクエストを発行する
*/10 * * * * wget -q -O /dev/null http://(mydns.jp のマスターID):(mydns.jp のパスワード)@www.mydns.jp/login.html
```



## (4)ヘアピンNATへの対応

同一のネットワーク内からグローバルIPにアクセスしようとするとルータが対応していないと拒否される

以下で設定しておけば，拒否されなくなるので登録する

```
$ sudo vim /etc/hosts
```

```
#以下の１行を追加して保存
<固定したサーバのローカルIP> <MyDNSで取得したドメイン名>
```

## (5) 接続

```
$ ssh -p 5504 -i ~/.ssh/home_ubuntu ユーザー名@グローバルIP
```

グローバルIPは再起動するたびに変わるので注意。

-->結果：LAN内からだと接続できるが、LAN外からだとできない。ポート開放はできてるっぽい。